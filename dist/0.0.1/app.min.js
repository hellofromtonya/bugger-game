"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==(void 0===call?"undefined":_typeof2(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+(void 0===superClass?"undefined":_typeof2(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==(void 0===call?"undefined":_typeof2(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+(void 0===superClass?"undefined":_typeof2(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==(void 0===call?"undefined":_typeof2(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+(void 0===superClass?"undefined":_typeof2(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==(void 0===call?"undefined":_typeof2(call))&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+(void 0===superClass?"undefined":_typeof2(superClass)));subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!function(){function _load(url){if(resourceCache[url])return resourceCache[url];var img=new Image;img.onload=function(){resourceCache[url]=img,isReady()&&readyCallbacks.forEach(function(func){func()})},resourceCache[url]=!1,img.src=url}function isReady(){var ready=!0;for(var k in resourceCache)resourceCache.hasOwnProperty(k)&&!resourceCache[k]&&(ready=!1);return ready}var resourceCache={},readyCallbacks=[];window.Resources={load:function(urlOrArr){urlOrArr instanceof Array?urlOrArr.forEach(function(url){_load(url)}):_load(urlOrArr)},get:function(url){return resourceCache[url]},onReady:function(func){readyCallbacks.push(func)},isReady:isReady}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),GameBoard=function(){function GameBoard(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$boardWidth=_ref.boardWidth,boardWidth=void 0===_ref$boardWidth?606:_ref$boardWidth,_ref$boardHeight=_ref.boardHeight,boardHeight=void 0===_ref$boardHeight?606:_ref$boardHeight,_ref$rows=_ref.rows,rows=void 0===_ref$rows?6:_ref$rows,_ref$columns=_ref.columns,columns=void 0===_ref$columns?5:_ref$columns;_classCallCheck(this,GameBoard),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=boardWidth,this.canvas.height=boardHeight,this._rows=rows,this._columns=columns,document.getElementsByClassName("game-board-container")[0].appendChild(this.canvas),this.elements={score:document.getElementsByClassName("score")[0]}}return _createClass(GameBoard,[{key:"reset",value:function(){}},{key:"render",value:function(){for(var rowImages=["images/water-block.png","images/stone-block.png","images/stone-block.png","images/stone-block.png","images/grass-block.png","images/grass-block.png"],row=0;row<this._rows;row++)for(var col=0;col<this._columns;col++)this.ctx.drawImage(Resources.get(rowImages[row]),101*col,83*row)}},{key:"updateScore",value:function(score){this.elements.score.innerHTML=score}}]),GameBoard}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Modal=function(){function Modal(modalID){_classCallCheck(this,Modal),this._modal=document.getElementById(modalID),this._playButton=this._modal.getElementsByClassName("play-again")[0],this._score=this._modal.getElementsByClassName("score")}return _createClass(Modal,[{key:"show",value:function(){var score=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._score.length>0&&(this._score[0].innerHTML=score),this._modal.classList.add("active")}},{key:"hide",value:function(){this._modal.classList.remove("active")}},{key:"showPlayButton",value:function(){this._playButton.classList.remove("hide")}},{key:"setCharacter",value:function(character){var characters=Array.from(document.querySelectorAll(".character__image"));if(0!==characters.length){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=characters[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)_step.value.classList.remove("active")}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}character.classList.add("active")}}}]),Modal}(),_typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return void 0===obj?"undefined":_typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":void 0===obj?"undefined":_typeof2(obj)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),GamePiece=function(){function GamePiece(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$row=_ref.row,row=void 0===_ref$row?0:_ref$row,_ref$col=_ref.col,col=void 0===_ref$col?0:_ref$col,_ref$startingPosition=_ref.startingPosition,startingPosition=void 0===_ref$startingPosition?{x:null,y:null}:_ref$startingPosition,_ref$speed=_ref.speed,speed=void 0===_ref$speed?100:_ref$speed,_ref$sprite=_ref.sprite,sprite=void 0===_ref$sprite?"":_ref$sprite;_classCallCheck(this,GamePiece),sprite&&this.setSprite("images/"+sprite),this.size={w:gameConfig.gamePiece.w,h:gameConfig.gamePiece.h},this.speed=speed,this.insertionMidPt={x:this.size.w/2,y:this.size.h/2-40},this.startingPosition={x:startingPosition.hasOwnProperty("x")&&null!==startingPosition.x?startingPosition.x:col*gameConfig.space.w-gameConfig.space.mid.x-this.insertionMidPt.x,y:startingPosition.hasOwnProperty("y")&&null!==startingPosition.y?startingPosition.y:row*gameConfig.space.h-gameConfig.space.mid.y-this.insertionMidPt.y},this.coords={x:this.startingPosition.x,y:this.startingPosition.y},this._location=this.getLocation(),this._points=0}return _createClass(GamePiece,[{key:"getLocation",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.updateLocation(),this._location}},{key:"updateLocation",value:function(){this._location={row:this.getRowLocation(),col:this.getColLocation()}}},{key:"getRowLocation",value:function(){return Math.min(Math.ceil(this.coords.y/gameConfig.space.h)+1,gameConfig.rows)}},{key:"getColLocation",value:function(){return Math.min(Math.ceil(this.coords.x/gameConfig.space.w)+1,gameConfig.columns)}},{key:"update",value:function(){var dt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,newX=this.coords.x+dt*this.speed;this.coords.x=newX<gameConfig.boundLimits.right+this.size.w?newX:-this.size.w}},{key:"render",value:function(ctx){ctx.drawImage(Resources.get(this.sprite),this.coords.x,this.coords.y)}},{key:"reset",value:function(){this.coords.x=this.startingPosition.x,this.coords.y=this.startingPosition.y,this.updateLocation()}},{key:"setSprite",value:function(newSprite){var callback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{obj:{},cb:{}};this.sprite=newSprite,Resources.load(newSprite),"object"===(void 0===callback?"undefined":_typeof(callback))&&"function"==typeof callback.cb&&Resources.onReady(function(){callback.cb.call(callback.obj)})}},{key:"setPoints",value:function(points){this._points=points}},{key:"getPoints",value:function(){return this._points}}]),GamePiece}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Enemy=function(_GamePiece){function Enemy(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$row=_ref.row,row=void 0===_ref$row?0:_ref$row,_ref$col=_ref.col,col=void 0===_ref$col?0:_ref$col,_ref$startingPosition=_ref.startingPosition,startingPosition=void 0===_ref$startingPosition?{x:null,y:null}:_ref$startingPosition,_ref$speed=_ref.speed,speed=void 0===_ref$speed?200:_ref$speed,_ref$sprite=_ref.sprite,sprite=void 0===_ref$sprite?"enemy-bug.png":_ref$sprite;return _classCallCheck(this,Enemy),_possibleConstructorReturn(this,(Enemy.__proto__||Object.getPrototypeOf(Enemy)).call(this,{row:row,col:col,startingPosition:startingPosition,speed:speed,sprite:sprite}))}return _inherits(Enemy,GamePiece),_createClass(Enemy,[{key:"getColLocation",value:function(){return Math.min(Math.ceil(this.coords.x/gameConfig.space.w),gameConfig.columns)}}]),Enemy}(),_typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return void 0===obj?"undefined":_typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":void 0===obj?"undefined":_typeof2(obj)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),GamePiecePool=function(){function GamePiecePool(gameBoardCTX){_classCallCheck(this,GamePiecePool),this._gameBoardCTX=gameBoardCTX,this._pool=[],this._uniqueCoords=[]}return _createClass(GamePiecePool,[{key:Symbol.iterator,value:function(){var _this=this,index=-1;return{next:function(){return{value:_this._pool[++index],done:!(index in _this._pool)}}}}},{key:"create",value:function(){for(var qty=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,poolIndex=1;poolIndex<=qty;poolIndex++){var gamePiece=this._createGamePiece(poolIndex);"object"===(void 0===gamePiece?"undefined":_typeof(gamePiece))&&this._pool.push(gamePiece)}}},{key:"_createGamePiece",value:function(poolIndex){return new GamePiece}},{key:"delete",value:function(gamePiece){var index=this._pool.indexOf(gamePiece);this._pool.splice(index,1)}},{key:"render",value:function(){var _this2=this;this._pool.forEach(function(gamePiece){return gamePiece.render(_this2._gameBoardCTX)})}},{key:"reset",value:function(){this._pool=[]}},{key:"update",value:function(){var dt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._pool.forEach(function(gamePiece){return gamePiece.update(dt)})}},{key:"generateUniqueCoords",value:function(){for(var rowRange=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{max:4,min:2},columnRange=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{max:6,min:1},coords={x:0,y:0};;){coords={x:this.constructor.generateRandom(columnRange.max,columnRange.min),y:this.constructor.generateRandom(rowRange.max,rowRange.min)};var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this._uniqueCoords[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var uniqueCoords=_step.value;uniqueCoords.x!==coords.x||(uniqueCoords.y,coords.y)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}break}return this._uniqueCoords.push(coords),coords}}],[{key:"generateRandom",value:function(max,min){var returnFloating=arguments.length>2&&void 0!==arguments[2]&&arguments[2],randomNumber=Math.random()*(max-min+1);return!0===returnFloating?randomNumber+min:Math.floor(randomNumber)+min}}]),GamePiecePool}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),EnemyPool=function(_GamePiecePool){function EnemyPool(gameBoardCTX){return _classCallCheck(this,EnemyPool),_possibleConstructorReturn(this,(EnemyPool.__proto__||Object.getPrototypeOf(EnemyPool)).call(this,gameBoardCTX))}return _inherits(EnemyPool,GamePiecePool),_createClass(EnemyPool,[{key:"_createGamePiece",value:function(poolIndex){var enemy=new Enemy({row:this.constructor.generateRandom(4,2),startingPosition:{x:this.constructor.generateRandom(gameConfig.boundLimits.right,1,!0)*this.constructor.generateRandom(10,1)}});return poolIndex%2!=0&&(enemy.speed*=this.constructor.generateRandom(3,1.5,!0)),enemy}}]),EnemyPool}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),CollectiblePool=function(_GamePiecePool){function CollectiblePool(gameBoardCTX){_classCallCheck(this,CollectiblePool);var _this=_possibleConstructorReturn(this,(CollectiblePool.__proto__||Object.getPrototypeOf(CollectiblePool)).call(this,gameBoardCTX));return _this._images=["gem-blue.png","gem-green.png","gem-orange.png"],_this}return _inherits(CollectiblePool,GamePiecePool),_createClass(CollectiblePool,[{key:"_createGamePiece",value:function(poolIndex){if(poolIndex>this._images.length)return!1;var coords=this.generateUniqueCoords(),gamePiece=new GamePiece({row:coords.y,col:coords.x,speed:0,sprite:this._images[poolIndex-1]});return gamePiece.startingPosition.y-=25,gamePiece.coords.y=gamePiece.startingPosition.y,gamePiece.setPoints(1e3),gamePiece}}]),CollectiblePool}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Player=function(_GamePiece){function Player(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$row=_ref.row,row=void 0===_ref$row?5:_ref$row,_ref$col=_ref.col,col=void 0===_ref$col?3:_ref$col;_classCallCheck(this,Player);var _this=_possibleConstructorReturn(this,(Player.__proto__||Object.getPrototypeOf(Player)).call(this,{row:row,col:col}));return _this.allowedKeys={37:"left",38:"up",39:"right",40:"down"},_this._score=0,_this}return _inherits(Player,GamePiece),_createClass(Player,[{key:"isValidMoveCommand",value:function(keyCode){return this.allowedKeys.hasOwnProperty(keyCode)}},{key:"handleInput",value:function(keyCode){switch(this.allowedKeys[keyCode]){case"left":this.coords.x=Math.max(this.coords.x-gameConfig.space.w,gameConfig.boundLimits.left);break;case"up":this.coords.y=Math.max(this.coords.y-gameConfig.space.h,gameConfig.boundLimits.up);break;case"right":this.coords.x=Math.min(this.coords.x+gameConfig.space.w,gameConfig.boundLimits.right);break;case"down":this.coords.y=Math.min(this.coords.y+gameConfig.space.h,gameConfig.boundLimits.down)}this.updateLocation()}},{key:"hasWon",value:function(){return 1===this.getLocation(!0).row}},{key:"addScore",value:function(){var points=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._score+=points}},{key:"getScore",value:function(){return this._score}}]),Player}(),_typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return void 0===obj?"undefined":_typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":void 0===obj?"undefined":_typeof2(obj)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),GameController=function(){function GameController(player,gameBoard){var modals=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{setup:{},wonModal:{},lostModal:{}};_classCallCheck(this,GameController),this._player=player,this._gameBoard=gameBoard,this._modals=modals,this._lastTime=0,this._enemies=new EnemyPool(this._gameBoard.ctx),this._collectibles=new CollectiblePool(this._gameBoard.ctx)}return _createClass(GameController,[{key:"registerEventListeners",value:function(){var _this=this;document.addEventListener("keyup",function(event){return _this.handlePlayerMove(event)},!1),document.getElementsByTagName("body")[0].addEventListener("click",function(event){return event.stopPropagation(),event.target.classList.contains("character__image")||"IMG"==event.target.nodeName&&event.target.parentNode.classList.contains("character__image")?this.updatePlayerCharacter(event.target):event.target.classList.contains("play-again")?this.startNewGame():void 0}.bind(this),!1)}},{key:"handlePlayerMove",value:function(event){event.stopImmediatePropagation(),this._player.isValidMoveCommand(event.keyCode)&&this._player.handleInput(event.keyCode)}},{key:"updatePlayerCharacter",value:function(target){if(!(target.classList.contains("character__image")||"IMG"==target.nodeName&&target.parentNode.classList.contains("character__image")))return!1;var li=void 0,img=void 0;return"IMG"==target.nodeName?(li=target.parentNode,img=target):(li=target,img=target.getElementsByTagName("img")[0]),this._modals.setup.setCharacter(li),this._player.setSprite(img.getAttribute("src"),{obj:this._modals.setup,cb:this._modals.setup.showPlayButton}),!1}},{key:"startNewGame",value:function(){return this.reset(),this._enemies.create(EnemyPool.generateRandom(6,3)),this._collectibles.create(EnemyPool.generateRandom(3,2)),this.updateGamePieces(),this.render(),this._lastTime=Date.now(),this.play(),!1}},{key:"play",value:function(){var now=Date.now(),dt=(now-this._lastTime)/1e3;return this.updateGamePieces(dt),this._lastTime=now,this.render(),this.hasCollided()?this.gameOver(!1):this._player.hasWon()?this.gameOver(!0):(this.checkCollectible(),void window.requestAnimationFrame(this.play.bind(this)))}},{key:"checkCollectible",value:function(){var collectible=this.hasCollided("_collectibles",!0);"object"===(void 0===collectible?"undefined":_typeof(collectible))&&(this._player.addScore(collectible.getPoints()),this._gameBoard.updateScore(this._player.getScore()),this._collectibles.delete(collectible))}},{key:"hasCollided",value:function(){var poolProperty=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"_enemies",returnGamePiece=arguments.length>1&&void 0!==arguments[1]&&arguments[1],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this[poolProperty][Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var gamePiece=_step.value;if(this.isOnSameSpace(gamePiece))return!returnGamePiece||gamePiece}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return!1}},{key:"isOnSameSpace",value:function(gamePiece){var playerLoc=this._player.getLocation(!0),gamePieceLoc=gamePiece.getLocation();return playerLoc.row===gamePieceLoc.row&&playerLoc.col===gamePieceLoc.col}},{key:"render",value:function(){this._gameBoard.render(),this._player.render(this._gameBoard.ctx),this._enemies.render(),this._collectibles.render()}},{key:"reset",value:function(){for(var modalKey in this._modals)this._modals[modalKey].hide();this._gameBoard.reset(),this._enemies.reset(),this._player.reset(),this._collectibles.reset()}},{key:"updateGamePieces",value:function(){var dt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._enemies.update(dt),this._player.update(),this._collectibles.update()}},{key:"gameOver",value:function(){var playerWon=arguments.length>0&&void 0!==arguments[0]&&arguments[0],score=this._player.getScore(),points=!0===playerWon?1e4:score>1e4?-1e4:-score;this._player.addScore(points),score=this._player.getScore(),this._gameBoard.updateScore(score),!0===playerWon?this._modals.wonModal.show(score):this._modals.lostModal.show()}}]),GameController}(),gameConfig={dims:{w:505,h:606},boundLimits:{up:-10,down:402,left:0,right:404},space:{w:101,h:83,mid:{x:50.5,y:41.5}},rows:6,columns:5,gamePiece:{w:101,h:171}};Resources.load(["images/stone-block.png","images/water-block.png","images/grass-block.png","images/enemy-bug.png","images/gem-blue.png","images/gem-green.png","images/gem-orange.png"]);var gameController=new GameController(new Player,new GameBoard({boardWidth:gameConfig.dims.w,boardHeight:gameConfig.dims.h,rows:gameConfig.rows,columns:gameConfig.columns}),{setup:new Modal("setup"),wonModal:new Modal("won-game-modal"),lostModal:new Modal("lost-game-modal")});gameController.registerEventListeners();